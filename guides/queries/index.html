<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Queries - Guides - Mongorito</title>
    
    <link href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600,400italic" rel="stylesheet" type="text/css" />
    <link href="/stylesheets/guides-52985f47.css" rel="stylesheet" type="text/css" />
  </head>
  
  <body class="guides guides_queries guides_queries_index">
    <div class="container">
      <nav class="navbar row">
        <ul class="nine columns">
          <li><a class="logo" href="/"><i class="icon icon-home"></i></a></li>
          <li><a href="/">Mongorito</a></li>
          <li><a href="/guides/getting-started">Quick Start</a></li>
          <li><a href="/guides">Guides</a></li>
        </ul>
        
        <ul class="three columns">
          <li><a href="https://github.com/vdemedes/mongorito" target="_blank">Github</a></li>
        </ul>
      </nav>
      
      <h1>Queries</h1>

<p>After reading this guide you will know:</p>

<ol>
<li>How to query documents from a database</li>
<li>Execute <em>where</em> queries with strings, objects and regular expressions</li>
<li>Paginate documents</li>
<li>Use $lt, $lte, $gt, $gte</li>
<li>Use $in and $nin</li>
</ol>

<blockquote>
<p>This guide assumes that you have a basic knowledge of Mongorito and you&rsquo;ve already read <a href="/guides/getting-started">Getting Started</a> guide.</p>
</blockquote>

<h3>Finding documents</h3>

<p>There are multiple ways of fetching records from the database in Mongorito.
Let&rsquo;s break it all down into a simple list for easier understanding of methods and their alternatives.</p>

<blockquote>
<p>I assume that you&rsquo;ve already set up Post model.</p>
</blockquote>

<h4>Find all</h4>

<p>Finds all documents in collection.</p>
<div class="highlight javascript"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="kd">var</span> <span class="nx">posts</span> <span class="o">=</span> <span class="nx">yield</span> <span class="nx">Post</span><span class="p">.</span><span class="nx">all</span><span class="p">();</span>
</pre></td></tr></tbody></table>
</div>

<p>Alternative:</p>
<div class="highlight javascript"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="kd">var</span> <span class="nx">posts</span> <span class="o">=</span> <span class="nx">yield</span> <span class="nx">Post</span><span class="p">.</span><span class="nx">find</span><span class="p">();</span>
</pre></td></tr></tbody></table>
</div>

<blockquote>
<p>Queries <strong>always</strong> return an array</p>
</blockquote>

<h4>Find where</h4>

<p>Finds document in collection, that match certain criteria.
Example, that fetches all documents where <em>title</em> equals &lsquo;Great title&rsquo;:</p>
<div class="highlight javascript"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="kd">var</span> <span class="nx">posts</span> <span class="o">=</span> <span class="nx">yield</span> <span class="nx">Post</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span> <span class="na">title</span><span class="p">:</span> <span class="s1">'Great title'</span> <span class="p"});</span>
</pre></td></tr></tbody></table>
</div>

<p>Alternatives:</p>
<div class="highlight javascript"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre><span class="kd">var</span> <span class="nx">posts</span> <span class="o">=</span> <span class="nx">yield</span> <span class="nx">Post</span><span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'title'</span><span class="p">,</span> <span class="s1">'Great title'</span><span class="p">).</span><span class="nx">find</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">posts</span> <span class="o">=</span> <span class="nx">yield</span> <span class="nx">Post</span><span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'title'</span><span class="p">).</span><span class="nx">equals</span><span class="p">(</span><span class="s1">'Great title'</span><span class="p">).</span><span class="nx">find</span><span class="p">();</span>
</pre></td></tr></tbody></table>
</div>

<p>Fetch all documents where sub-property <em>name</em> of property <em>author</em> equals &#39;John Doe&rsquo;:</p>
<div class="highlight javascript"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="kd">var</span> <span class="nx">posts</span> <span class="o">=</span> <span class="nx">yield</span> <span class="nx">Post</span><span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'author.name'</span><span class="p">,</span> <span class="s1">'John Doe'</span><span class="p">).</span><span class="nx">find</span><span class="p">();</span>
</pre></td></tr></tbody></table>
</div>

<p>Fetch documents, where sub-documents match a criteria:</p>
<div class="highlight javascript"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre><span class="c1">// matching posts where at least one comment.body is "Nice comment"</span>
<span class="kd">var</span> <span class="nx">posts</span> <span class="o">=</span> <span class="nx">yield</span> <span class="nx">Post</span><span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'comments'</span><span class="p">,</span> <span class="p">{</span> <span class="na">body</span><span class="p">:</span> <span class="s1">'Nice comment'</span> <span class="p">}).</span><span class="nx">find</span><span class="p">();</span>
</pre></td></tr></tbody></table>
</div>

<p>Fetch documents with a regular expression:</p>
<div class="highlight javascript"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="kd">var</span> <span class="nx">posts</span> <span class="o">=</span> <span class="nx">yield</span> <span class="nx">Post</span><span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'title'</span><span class="p">,</span> <span class="sr">/great/i</span><span class="p">).</span><span class="nx">find</span><span class="p">();</span>
</pre></td></tr></tbody></table>
</div>

<h4>Find where field exists</h4>

<p>Find documents where field <em>title</em> exists:</p>
<div class="highlight javascript"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="kd">var</span> <span class="nx">posts</span> <span class="o">=</span> <span class="nx">yield</span> <span class="nx">Post</span><span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'title'</span><span class="p">).</span><span class="nx">exists</span><span class="p">().</span><span class="nx">find</span><span class="p">();</span>
</pre></td></tr></tbody></table>
</div>

<h4>Find where field passes logical operator</h4>

<p>There are 4 types of logical operators available:</p>

<ol>
<li>Greater than (&gt;, $gt)</li>
<li>Greater or equal than (&gt;=, $gte)</li>
<li>Less than (&lt;, $lt)</li>
<li>Less or equal than (&lt;=, $lte)</li>
</ol>

<p>Example:</p>
<div class="highlight javascript"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre><span class="kd">var</span> <span class="nx">posts</span> <span class="o">=</span> <span class="nx">yield</span> <span class="nx">Post</span><span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'position'</span><span class="p">).</span><span class="nx">gt</span><span class="p">(</span><span class="mi">5</span><span class="p">).</span><span class="nx">find</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">posts</span> <span class="o">=</span> <span class="nx">yield</span> <span class="nx">Post</span><span class="p">.</span><span class="nx">gt</span><span class="p">(</span><span class="s1">'position'</span><span class="p">,</span> <span class="mi">5</span><span class="p">).</span><span class="nx">find</span><span class="p">();</span>
</pre></td></tr></tbody></table>
</div>

<h4>Find using &ldquo;in&rdquo; or &ldquo;not in&rdquo;</h4>

<p>Find documents where field value is in or not in supplied array:</p>
<div class="highlight javascript"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="kd">var</span> <span class="nx">posts</span> <span class="o">=</span> <span class="nx">yield</span> <span class="nx">Post</span><span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'title'</span><span class="p">).</span><span class="k">in</span><span class="p">([</span><span class="s1">'First title'</span><span class="p">,</span> <span class="s1">'Second title'</span><span class="p">]).</span><span class="nx">find</span><span class="p">();</span>
</pre></td></tr></tbody></table>
</div>

<p>This will find all post documents where <em>title</em> equals &#39;First title&rsquo; or &#39;Second title&rsquo;.</p>

<h3>Pagination</h3>

<p>Pagination in MongoDB database is based on <mark>.skip() and .limit()</mark> methods:</p>
<div class="highlight javascript"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="kd">var</span> <span class="nx">posts</span> <span class="o">=</span> <span class="nx">yield</span> <span class="nx">Post</span><span class="p">.</span><span class="nx">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">).</span><span class="nx">skip</span><span class="p">(</span><span class="mi">10</span><span class="p">).</span><span class="nx">find</span><span class="p">();</span>
</pre></td></tr></tbody></table>
</div>

<p>This tells MongoDB to return <strong>5</strong> post documents, while skipping <strong>first 10</strong>.</p>

      
      <footer>Made by <a href="https://twitter.com/vdemedes" target="_blank">Vadim Demedes</a></footer>
    </div>
    
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js" type="text/javascript"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js" type="text/javascript"></script>
    
    <script>
  	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  	  ga('create', 'UA-56814364-1', 'auto');
  	  ga('send', 'pageview');
  	</script>
  </body>
</html>
